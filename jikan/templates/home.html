{% extends 'base.html' %}
{% load socialaccount %}
{% load widget_tweaks %}


{% block javascript %}
    <script>
        $(document).ready(function(){
          $(".sim_button").click(function(){
                var pk = $(this).data('pid')
                $.ajax({
                    type: "GET",
                    data: {'pk': $(this).data('pid')},
                    url: "{% url 'search:get_recommendation' %}",
                    success: function(response) {
                        $("#sim_" + pk).html(response.rec_list + ", "+ response.rec_journal).css({ 'font-weight': 'bold' })
                        console.log($("#sim_" + pk))
                    },
                    error: function(response, error) {
                        alert(error);
                    }
                });
            });
          });
    </script>
    <script>
        $(document).ready(function(){
          $(".like_button").click(function(){
                var pk = $(this).data('pid')
                $.ajax({
                    type: "GET",
                    data: {'pk': pk,
                           'liked': $("span").hasClass('fa fa-thumbs-up') },
                    url: "{% url 'search:like_paper' %}",
                    success: function(response) {
                        $("#like_count_"+ pk).html(response.likes )
                    },
                    error: function(response, error) {
                        alert(error);
                    }
                });
            });
          });
    </script>
    <script>
        $(document).ready(function(){
            $("#txtSearch").autocomplete({
                source: "/ajax_calls/search/",
                minLength: 2,
                open: function(){
                    setTimeout(function () {
                        $('.ui-autocomplete').css('z-index', 99);
                    }, 0);
                }
              });
        });
      </script>
      <script>
        var infinite = new Waypoint.Infinite({
          element: $('.infinite-container')[0],
          onBeforePageLoad: function () {
            $('.loading').show();
          },
          onAfterPageLoad: function ($items) {
            $('.loading').hide();
          }
        });
      </script>
{% endblock %}


<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">

</head>


{% block fullwidthheader %}
    <section class="features">
    <div class="col-md-6 col-md-offset-3"  >
    <h2>Get Feedback for Your Paper.</h2>

          <div class="form-group" style="text-align:center">
            <form id="search" action="{% url 'search:search_paper' %}" method="GET" value="{{request.GET.q}}">
            {% csrf_token %}
            <input type="text"  class="form-control"  style="font-size: 12pt;" name="q" value="{{request.GET.q}}" placeholder="Paper Title" id="txtSearch" name="txtSearch"/><br>
            <button type="submit" class="btn btn-primary" name="submit" value="Search">Search</button>
            </form>
            </div>
            <p class="lead">
                <strong>Jikan</strong> is a platform that foster useful and supportive discussion to help researchers improve their work.</p>
                <p> <a href="{% url 'add_paper' %}" >Add your paper </a></h4> </p>


<!--
                <form id=”search” method="POST" action="{% url 'search:search_paper' %}">
                 {% csrf_token %}
                 <input type=”text” class="form-control" id="txtSearch" name="txtSearch">
                 <button type="submit" class="btn btn-default btn-submit">Submit</button>
                 </form> -->

    {% if submitbutton == 'Search' and request.GET.q != '' %}
    {% if results %}



    <h3>Search Results</b></h3>
        <br/>


        <div style="width: 90%; overflow: hidden;">

       {% for result in results %}
           <li >
            <a href="{% url 'paper_detail' pk=result.pk %}">{{ result.title}}</a>,
            {% for author in result.authors.all %}
                {{ author }},
                {% empty %}
                No assigned authors.
          {% endfor %}
            <strong> {{ result.journal }} </strong>
            <i>{{ result.year }} </i>

            <button class="sim_button" data-pid="{{ result.pk }}">Similar Papers </button>

               <a href="#" class="like_button" data-pid="{{ result.pk }}"> <span class="like_span fa fa-thumbs-up"></span>
                   <strong id="like_count_{{ result.pk }}">{{result.likes}} </strong> </a>
{% comment %}             |
                <a href="#" class="dislike_button" data-pid="{{ result.pk }}"> <span class="like_span fa fa-thumbs-down"></span>
                    <strong id="dislike_count_{{ result.pk }}"> {{result.dislikes}}</strong> </a>{% endcomment %}

            <br>
               <div class="expand" id="sim_{{ result.pk }}"></div>

           </li>



           <br/>

       {% endfor %}

            {% if results.has_other_pages %}
              <ul class="pagination">
                {% if results.has_previous %}
                  <li><a href="?q={{request.GET.q}}&submit=Search&page={{ results.previous_page_number }}">&laquo;</a></li>
                {% else %}
                  <li class="disabled"><span>&laquo;</span></li>
                {% endif %}
                {% for i in results.paginator.page_range %}
                  {% if results.number == i %}
                    <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
                  {% else %}
                    <li><a href="?q={{request.GET.q}}&submit=Search&page={{ i }}">{{ i }}</a></li>
                  {% endif %}
                {% endfor %}
                {% if results.has_next %}
                  <li><a href="?q={{request.GET.q}}&submit=Search&page={{ results.next_page_number }}">&raquo;</a></li>
                {% else %}
                  <li class="disabled"><span>&raquo;</span></li>
                {% endif %}
              </ul>
            {% endif %}
    {% else %}


        {% endif %}
    {% endif %}
    </div>
      </div>
    </section>

{% endblock fullwidthheader %}

{% block fullwidthfooter %}
  <section class="features">

  </section>
{% endblock fullwidthfooter %}
