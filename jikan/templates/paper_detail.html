{% extends 'base.html' %}
{% load socialaccount %}
{% load widget_tweaks %}
{% block javascript%}
<script src="http://malsup.github.com/jquery.form.js"></script>
<script>
    $(document).ready(function(){
      $(".like_button").click(function(){
            var pk = $(this).data('pid')
            $.ajax({
                type: "GET",
                data: {'pk': pk,
                       'liked': $("span").hasClass('fa fa-thumbs-up') },
                url: "{% url 'search:like_paper' %}",
                success: function(response) {
                    $("#like_count_"+ pk).html(response.likes )
                },
                error: function(response, error) {
                    alert(error);
                }
            });
        });
      });
</script>
<script>
$(document).ready(function(){
  $("#myBtn").click(function(){
    var pk = $(this).data('pid')
    $("#myModal").modal("show");
  });
  $("#myModal").on('show.bs.modal', function(event){
    var modal = $(this)
    var pk = $(this).data('pid')
    $.ajax({
        data: {'pk': pk},
        url: "{% url 'search:load_paper' %}",
        context: document.body,
        error: function(response, error) {
            alert(error);
        }
    }).done(function(response) {
        modal.html(response);
    });
  });
});
</script>
<script>
    $(document).ready(function(){
      $(".sim_button").click(function(){
            var pk = $(this).data('pid')
            $.ajax({
                type: "GET",
                data: {'pk': $(this).data('pid')},
                url: "{% url 'search:get_recommendation' %}",
                success: function(response) {
                    $("#sim_paper").html(response.rec_list + ", "+ response.rec_journal).css({ 'font-weight': 'bold' })
                    console.log($("#sim_" + pk))
                },
                error: function(response, error) {
                    alert(error);
                }
            });
        });
      });
</script>

{% endblock %}
{% block fullwidthheader %}
    <section class="features">
      <div class="container">
        {% if paper %}
          {% if can_edit %}

        <button type='button' class="btn btn-primary" data-toggle="modal" data-target="#modal" id="myBtn" data-pid={{paper.pk}} >Edit Paper Details</button>

        <button type="button" class="btn btn-default" data-toggle="modal" data-target="#fm-modal-grid" data-pid={{paper.pk}}>Delete Paper</button>

        <div class="modal fade" id="fm-modal-grid" tabindex="-1"
             role="dialog" aria-labelledBy="fm-modal-grid"
            aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button class="close" data-dismiss="modal" aria-label="Cerrar">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-12 col-sm-6">
                                    <p>Are you sure you want to delte {{paper.title}}?</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <a href="{% url 'search:remove_paper' pk=paper.pk %}" class="btn">Delete</a>
                        <button class="btn btn-primary" data-dismiss="modal">Cancel</button>

                    </div>
                </div>
            </div>
        </div>

        {% csrf_token %}

       <!-- Modal -->
       <div class="modal fade" id="myModal" role="dialog" data-pid={{paper.pk}}> {% csrf_token %}
         <div class="modal-dialog">
         </div>
       </div>

       {% endif %}

       <br>
       <!-- <div class="col-xs-16 col-sm-8"> -->
          <h3> {{ paper.title }}</h3>
              <a href="#" class="like_button" data-pid="{{ paper.pk }}"> <span class="like_span fa fa-thumbs-up fa-2x"></span>
                  <strong id="like_count_{{ paper.pk }}"> {{paper.likes}} </strong> </a> <br>
                  <br>
                  <p class="h5 text-secondary">Project Stage: <b> {{paper.get_status_display }} </b> <br>
                    Created At: <i>{{paper.year_month_created}}</i> <br>
                    {% if paper.created_by %}
                    Created By: <a href = "{% url 'search:view_user' pk=paper.created_by.pk %}"> {{paper.created_by.first_name}} {{paper.created_by.last_name}}</a> <br> </p>
                    {% endif %}
        <!-- <button class="sim_button" data-pid="{{ paper.pk }}">Similar Papers </button> -->

            <div class="expand" id="sim_paper"></div>
            <p class="h4 text-muted">    Abstract: </p>
            <p class="text-muted">     <br>{{ paper.abstract }} </p>

            <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#fm-modal-grid" data-pid={{paper.pk}}>Referee Comments</button>
            <span class="fa fa-plus-circle fa-2x"></span> 

        {% endif %}



        {% if paper.document %}
        <embed src={{paper.document.url}} width="800" height="1000"
          type="application/pdf">
        {% else %}
        {% endif %}
      <!-- </div> -->


    <div class="container">

      <!-- <div class = "col-xs-12 col-sm-8"> -->
      <div id="disqus_thread"></div>

        <script>

        /**
        *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
        *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
        /*
        var disqus_config = function () {
        this.page.url = 'http://127.0.0.1:8000/paper/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        };
        */
        (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://jikan-1.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




      <!-- {% for comment in paper.comments.all %}
          {% if user.is_authenticated or comment.approved_comment %}
          <div class="comment">
              <div class="date">
                  {{ comment.created_date }}
                  {% if not comment.approved_comment %}
                      <a class="btn btn-default" href="{% url 'comment_remove' pk=comment.pk %}"><span class="glyphicon glyphicon-remove"></span></a>
                      <a class="btn btn-default" href="{% url 'comment_approve' pk=comment.pk %}"><span class="glyphicon glyphicon-ok"></span></a>
                  {% endif %}
              </div>
              <strong>{{ comment.author }}</strong>
              <p>{{ comment.text|linebreaks }}</p>
          </div>
          {% endif %}
      {% empty %}
          <p>No comments here yet :( </p>
      {% endfor %} -->

      <!-- </div> -->
      </div>
    </section>

{% endblock fullwidthheader %}
